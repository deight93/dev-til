# 분산 데이터 저장소 복제 토폴로지 — 리더-팔로워 / 멀티리더 / 리더리스

> * **리더-팔로워**: 모델 단순·강C 용이. 페일오버/리더 병목 관리가 핵심.
> * **멀티리더**: 지역 쓰기 p99↓, 분할에도 쓰기 지속. **충돌 해결**을 반드시 설계.
> * **리더리스**: 고가용성·수평확장·튜너블 일관성. **수렴/버전 관리** 운영 난이도↑.

---

## 한눈 비교

| 항목     | 리더-팔로워 (Primary-Replica) | 멀티리더 (Active-Active)   | 리더리스 (Dynamo 계열)     |
| ------ | ------------------------ | ---------------------- | -------------------- |
| 쓰기     | 단일 리더 커밋 → 복제            | 각 리전 리더에 지역 쓰기         | 코디네이터가 N개에 병렬 쓰기     |
| 읽기     | 리더=강 / 팔로워=빠름(스테일 가능)    | 각 리전 리더 기준 강(전역 충돌 가능) | R of N 쿼럼 읽기(튜너블)    |
| 일관성 경향 | 강C 용이(리더 경로)             | 지역 강, 전역은 충돌 해결 필요     | 튜너블(R/W/N, R+W>N)    |
| 분할 시   | 리더 상실 시 **쓰기 중단(CP)**    | 다른 리더로 **쓰기 지속** → 충돌  | **쓰기 지속(AP)**, 사후 수렴 |
| 강점     | 단순·트랜잭션 유리               | 지역 쓰기 지연↓, 가용성↑        | 고가용성·확장성·핫리더 없음      |
| 약점     | 리더 병목·페일오버               | 충돌 규칙·루프 방지 필요         | 버전/수렴·운영 복잡          |

---

## 리더-팔로워 (Primary-Replica)

**언제 쓰나**

* 결제/원장/메타데이터 등 **불변식이 핵심**일 때
* 단일 리전 또는 리전-내 합의로 충분할 때

**운영 체크리스트**

* 리더 선출 기준(타임아웃·다수확인)과 **펜싱 토큰** 적용
* 팔로워 읽기엔 **세션 보장(RYW/MR)** 사용
* 복제 지연·리더 큐잉 p99 모니터링, 자동 페일오버 연습

---

## 멀티리더 (Active-Active)

**언제 쓰나**

* 글로벌 사용자 **지역 쓰기 지연이 치명적**일 때
* 약C 허용 + **도메인 충돌 규칙** 정의 가능할 때

**핵심 설계 포인트**

* **충돌 해결**: LWW, 도메인 우선순위, **CRDT(PN-Counter/OR-Set)**
* **충돌 회피**: 키의 **리전 고정(Geo-partitioning)**, 전역 유니크는 **영역 Prefix/스노우플레이크**

**운영 체크리스트**

* 복제 루프 방지(원본 ID/버전)
* 충돌률/수렴 시간 지표화
* 전역 제약(유니크/시퀀스)은 단일 리더 키 배치 또는 별도 합의 스토어

---

## 리더리스 (Dynamo 스타일)

**언제 쓰나**

* 가용성 최우선(AP) + **약C 허용** 도메인(피드/로그/텔레메트리/엣지)

**핵심 메커니즘**

* 일관 해싱, **W/R/N**(튜너블), **슬로피 쿼럼**, 힌티드 핸드오프, **머클트리** 안티엔트로피, Read-Repair
* 버전 벡터/타임스탬프 → **병합 규칙 필수**

**운영 체크리스트**

* 중요 요청=`QUORUM`, 일반=지역 최적(`LOCAL_ONE`) 등 **등급화**
* 수렴/충돌율·staleness 지표 관측
* 세션 토큰으로 **RYW 보강**, 백그라운드 리페어 주기 관리

---

## 요약

* **토폴로지=트레이드오프**: 일관성(C)·가용성(A)·지연(L)·운영 난이도를 어떻게 교환할지 결정하는 선택지입니다.
* **리더-팔로워**: 강C 용이·모델 단순. 팔로워 읽기는 **세션 보장(RYW/MR)** 로 보강, **페일오버/펜싱 토큰** 필수입니다.
* **멀티리더**: 지역 쓰기 p99↓·가용성↑. **충돌 해결(LWW/CRDT)** 및 **충돌 회피(Geo-partitioning)** 를 반드시 설계하십시오.
* **리더리스**: AP·수평확장·**튜너블 일관성(R/W/N)**. 중요=QUORUM, 일반=LOCAL\_\* 등 **등급화**와 **수렴 시간 SLO**가 핵심입니다.
