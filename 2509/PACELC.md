# PACELC 정리 (Abadi)

> **정의 한 줄**:
> **P**(네트워크 분할)일 때는 **A vs C**를 선택해야 하고(**CAP**), \*\*Else(평시)\*\*에도 **L(지연) vs C(일관성)** 사이에 상시 트레이드오프가 존재한다는 정리입니다.

---

## 왜 중요한가

* CAP는 “분할 시의 선택”만 말합니다. 실무에선 **분할이 없을 때도** 강한 일관성을 유지하려면 **합의·동기복제 비용으로 지연이 증가**합니다. PACELC는 이 **상시 비용 구조**를 설계에 반영하게 만듭니다.
* 멀티 리전·글로벌 서비스에서 **합의 반경(리전 간 RTT)** 이 성능을 지배합니다. “C를 얼마나 강하게, 어디서까지” 보장할지 의식적으로 결정하도록 합니다.

---

## 핵심 개념/표기

* 표기: **P(A|C) / E(L|C)** → 예: **PA/EL**, **PC/EC**

    * **PA/EL**: 분할 시 **가용성(A)** 우선, 평시 **지연(L)** 우선. (가급적 합의/동기복제 반경을 줄여 빠르게 응답)
    * **PC/EC**: 분할 시 **일관성(C)** 우선, 평시에도 **일관성(C)** 우선. (합의 반경이 커져도 강C 유지)
* 직관:

    * 글로벌 합의(멀티 리전 다수결)는 **평시에도** RTT만큼 **L↑**.
    * 리더리스/근접 리드/지역 쓰기 최적화는 \*\*L↓\*\*지만 **C를 완화**(최종·인과·세션 보장 등).

---

## 전형적 경향(예시로 이해)

* **PA/EL 경향**: Dynamo 계열, Riak, Cassandra(기본값). *튜너블 일관성*으로 특정 요청만 쿼럼 강화 가능.
* **PC/EC 경향**: Google Spanner, CockroachDB. 멀티 리전 합의(복제 그룹)로 **외부 일관성/강C** 확보.

> 참고: 특정 제품은 설정·토폴로지에 따라 달라집니다. “기본 철학/권장 아키텍처”의 경향으로 이해하시면 됩니다.

---

## 설계 판단 가이드 (요약 표)

| 워크로드/요구                  | 권장 경향     | 이유/설명                                                |
| ------------------------ | --------- | ---------------------------------------------------- |
| 결제/원장/주문·재고 등 **강한 불변식** | **PC/EC** | 강C 유지가 핵심. 평시에도 합의 비용(L↑) 수용. 리전 수 최소화/리전 친화 라우팅 병행. |
| 글로벌 읽기 많음, 약한 불일치 허용     | **PA/EL** | 지역 리드·리전 근접성으로 p99↓. 수렴/인과 보장으로 체감 품질 보완.            |
| 오프라인-퍼스트/엣지              | **PA/EL** | 연결 불안정/분할 상시 가정. 머지 규칙(CRDT/도메인 규칙)로 충돌 해결.          |
| 멀티 리전 트랜잭션(교차 파티션)       | **PC/EC** | 외부 일관성/원자성을 합의로 담보. 비용은 캐시·CQRS로 상쇄.                 |

---

## 평시 지연(L) 구성요소 (감 잡기)

* **합의/동기복제 지연**: `write_latency ≈ max(RTT to write quorum)`
* **리더 경유 지연**: 리더-팔로워 hop, 리더 핫스팟 시 큐잉 지연↑
* **리전 간 RTT**: 10\~200ms+ (거리·망 품질 의존) → **전역 합의는 상시 비용**
* **스토리지 비용**: 강C 시스템은 WAL/fsync/투표·확정 단계가 더 빈번

---

## 흔한 오해/함정

* “**강C는 분할 때만 비용**” → 오해입니다. **평시에도** 합의·동기복제 때문에 **지연이 늘어납니다**.
* “**AP=항상 틀림**” → 아님. 인과/세션/RYW, SLA 기반 재시도·보상 등으로 **체감 품질**을 높일 수 있습니다.
* “**한 번 PC/EC면 모두 강C**” → 읽기를 지역화(Follower reads)하면 일부 경로는 **약C**가 됩니다. 경로별 보장 명시 필요.

---

## 요약

* **PACELC**는 “분할 시(CAP)” 뿐 아니라 **평시에도 C를 유지하려면 L 비용을 치른다**는 현실을 수식화합니다.
* **PC/EC**는 강C·외부 일관성 확보(합의 반경↑, L↑), **PA/EL**은 지연 최적화(근접 리드/쓰기, C 완화).
* 정답은 도메인 불변식·SLO·지리적 배치로 결정됩니다. 대개 **핵심 상태=PC/EC**, **조회/파생 경로=PA/EL**의 **혼합 설계**가 실전 해법입니다.
